<!DOCTYPE html>
<html>
<head>
    <style>
        /* Style for the vertical crosshair */
        .vertical-crosshair {
            position: absolute;
            width: 1px;
            background-color: rgba(255, 0, 0, 0.8); /* Red color */
            height: 100%;
            z-index: 10;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="chart-container" style="width: 100%; height: 500px; position: relative;"></div>
    <div>
        <label for="datetime-input">Jump to Datetime:</label>
        <input type="datetime-local" id="datetime-input" />
        <button id="jump-button">Jump</button>
    </div>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        const chartContainer = document.getElementById('chart-container');
        const chart = LightweightCharts.createChart(chartContainer, { width: 600, height: 400 });
        const series = chart.addCandlestickSeries();

        series.setData([
            { time: '2024-11-28T03:45:00', open: 1.05, high: 1.1, low: 1.03, close: 1.06 },
            { time: '2024-11-28T04:00:00', open: 1.06, high: 1.09, low: 1.04, close: 1.05 },
            { time: '2024-11-28T04:15:00', open: 1.05, high: 1.08, low: 1.02, close: 1.03 },
            { time: '2024-11-28T04:30:00', open: 1.03, high: 1.07, low: 1.01, close: 1.02 },
        ]);

        let crosshairTime = null; // Store the target time for the crosshair

        function drawVerticalCrosshair(closestData) {
            crosshairTime = closestData.time; // Save the crosshair's time

            // Remove any existing crosshair
            const existingCrosshair = document.querySelector('.vertical-crosshair');
            if (existingCrosshair) existingCrosshair.remove();

            // Create a new crosshair line
            const verticalLine = document.createElement('div');
            verticalLine.className = 'vertical-crosshair';
            chartContainer.appendChild(verticalLine);

            // Position the crosshair
            updateVerticalCrosshair();
        }

        function updateVerticalCrosshair() {
            if (crosshairTime === null) return; // No crosshair to update

            // Get the X-coordinate of the crosshair's time
            const xCoordinate = chart.timeScale().timeToCoordinate(crosshairTime);
            const verticalLine = document.querySelector('.vertical-crosshair');

            if (xCoordinate !== null && verticalLine) {
                verticalLine.style.left = `${xCoordinate}px`;
            } else if (verticalLine) {
                // If the time is no longer visible, hide the crosshair
                verticalLine.style.left = '-9999px';
            }
        }

        // Listen for changes to the chart's visible time range
        chart.timeScale().subscribeVisibleTimeRangeChange(() => {
            updateVerticalCrosshair();
        });

        // Handle jump functionality
        document.getElementById('jump-button').addEventListener('click', () => {
            const datetimeInput = document.getElementById('datetime-input').value;
            if (!datetimeInput) return;

            const jumpTime = new Date(datetimeInput).toISOString();
            const closestData = series.data().find(data => data.time === jumpTime);

            if (closestData) {
                chart.timeScale().setVisibleRange({ from: jumpTime, to: jumpTime });
                drawVerticalCrosshair(closestData);
            } else {
                alert('No data for the selected time');
            }
        });
    </script>
</body>
</html>
